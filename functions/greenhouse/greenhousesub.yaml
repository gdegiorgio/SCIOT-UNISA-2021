metadata:
  name: greenhousesub
  labels:
    nuclio.io/project-name: 9cc3cc05-262c-405e-a0e7-010494876ae1
spec:
  description: "Function listening on  MQTT queue receiving greenhouse temperature"
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-greenhousesub:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    mqttTrigger:
      class: ""
      kind: mqtt
      url: "172.17.0.1:1883"
      username: guest
      password: guest
      attributes:
        subscriptions:
          - qos: 1
            topic: greenhouse/temperature
  version: 1
  build:
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: dmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0JyksIHVybCA9IHJlcXVpcmUoJ3VybCcpOwpjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7CmNvbnN0IGF4aW9zID0gcmVxdWlyZSgnYXhpb3MnKQp2YXIgbXF0dF91cmwgPSB1cmwucGFyc2UocHJvY2Vzcy5lbnYuQ0xPVURBTVFQX01RVFRfVVJMIHx8ICdtcXR0Oi8vZ3Vlc3Q6Z3Vlc3RAMTcyLjE3LjAuMzoxODgzJyk7CnZhciBhdXRoID0gKG1xdHRfdXJsLmF1dGggfHwgJzonKS5zcGxpdCgnOicpOwp2YXIgdXJsID0gIm1xdHQ6Ly8iICsgbXF0dF91cmwuaG9zdDsKCmNvbnN0IGNvbnRlbnQgPSAnU29tZSBjb250ZW50ISc7CgoKY29uc3QgbW9uZ29kYl91cmwgPSAiaHR0cHM6Ly9kYXRhLm1vbmdvZGItYXBpLmNvbS9hcHAvZGF0YS12cnNmbC9lbmRwb2ludC9kYXRhL2JldGEvYWN0aW9uL2luc2VydE9uZSIKY29uc3QgYXBpX2tleSA9ICJXeFFUNHRxMkNMS2JuTEtHY3VxOWRNTUhxUUo5NkhmQVA2RXJmOGtmSnpkV0V1VURZSG45TmJGZ0ZnclR6Rkw3IjsKCgpmdW5jdGlvbiBiaW4yc3RyaW5nKGFycmF5KSB7CiAgdmFyIHJlc3VsdCA9ICIiOwogIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyArK2kpIHsKICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGFycmF5W2ldKTsKICB9CiAgcmV0dXJuIHJlc3VsdDsKfQoKZXhwb3J0cy5oYW5kbGVyID0gZnVuY3Rpb24gKGNvbnRleHQsIGV2ZW50KSB7Cgp2YXIgX2V2ZW50ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShldmVudCkpOwp2YXIgdGVtcGVyYXR1cmUgPSBiaW4yc3RyaW5nKF9ldmVudC5ib2R5LmRhdGEpOwpmcy53cml0ZUZpbGUoIi90bXAvbG9nLnR4dCIsIHRlbXBlcmF0dXJlLCBlcnIyID0+IHt9KQogICAgICAgIGxldCBib2R5ID0gewogICAgICAgICAgICAnZGF0YVNvdXJjZSc6ICdDbHVzdGVyMCcsCiAgICAgICAgICAgICdkYXRhYmFzZSc6ICdncmVlbmhvdXNlJywKICAgICAgICAgICAgJ2NvbGxlY3Rpb24nOiAndGVtcGVyYXR1cmUnLAogICAgICAgICAgICAiZG9jdW1lbnQiOiB7CiAgICAgICAgICAgICAgICAidGVtcGVyYXR1cmUiOiB0ZW1wZXJhdHVyZSwKICAgICAgICAgICAgICAgICJkYXRldGltZSIgOiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZXQgY29uZmlnID0gewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLVJlcXVlc3QtSGVhZGVycyc6ICcqJywKICAgICAgICAgICAgICAgICdhcGkta2V5JzogYXBpX2tleQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBheGlvcy5wb3N0KG1vbmdvZGJfdXJsLCBib2R5LCBjb25maWcpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGNvbnRleHQuY2FsbGJhY2soJ0NyZWF0ZWQgbmV3IE1vbmdvIERCIGRvY3VtZW50IDogJywgcmVzcG9uc2UpCiAgICAgICAgfSkKICAgIH07+IHt9KQogICAgICAgIGxldCBib2R5ID0gewogICAgICAgICAgICAnZGF0YVNvdXJjZSc6ICdDbHVzdGVyMCcsCiAgICAgICAgICAgICdkYXRhYmFzZSc6ICdncmVlbmhvdXNlJywKICAgICAgICAgICAgJ2NvbGxlY3Rpb24nOiAndGVtcGVyYXR1cmUnLAogICAgICAgICAgICAiZG9jdW1lbnQiOiB7CiAgICAgICAgICAgICAgICAidGVtcGVyYXR1cmUiOiB0ZW1wZXJhdHVyZSwKICAgICAgICAgICAgICAgICJkYXRldGltZSIgOiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZXQgY29uZmlnID0gewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLVJlcXVlc3QtSGVhZGVycyc6ICcqJywKICAgICAgICAgICAgICAgICdhcGkta2V5JzogYXBpX2tleQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBheGlvcy5wb3N0KG1vbmdvZGJfdXJsLCBib2R5LCBjb25maWcpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGNvbnRleHQuY2FsbGJhY2soJ0NyZWF0ZWQgbmV3IE1vbmdvIERCIGRvY3VtZW50IDogJywgcmVzcG9uc2UpCiAgICAgICAgfSkKICAgIH07
    baseImage: "node:14-alpine"
    commands:
      - 'npm install mqtt'
      - 'npm install axios'
    codeEntryType: sourceCode
  platform: {}
